# Лабораторна №7-8. Розробка мікросервісів для аналізу геопросторових даних
## Мета: побудувати повноцінну мікросервісну архітектуру для розподіленої роботи декількох сервісів по обробці геопросторових даних.

### Завдання

1. Створити у репозиторії каталог із назвою **Lab_08**. Всю необхідну структуру проектів та мікросервісів необхідно виконувати у ньому.
2. Створити *.env* файл для збереження параметрів сервісів та підключень.
3. Створити *Dockerfile*, який завантажує образ бази даних **PostgreSQL** із розширенням **PostGIS**.
4. Створити *docker-compose.yml* файл, який запускає сервіси Zookeeper, Kafka та база даних на основі попереднього пункту
5. Створити сервіс, який із датасету **field_centroids.geojson** читає дані про поля та записує їх у створену базу даних. Коли інформація про поля додана у базу, він відправляє у **Kafka** в канал **field-reading** відповідне повідомлення. Додати відповідний *Dockerfile* для створення контейнеру та налаштувати запуск у *docker-compose*.
6. Створити сервіс, який чекає у **Kafka** в канал **field-reading** повідомлення про наявність полів у базі даних. Після цього він читає координати із текстового файлу **POI.txt**, вибирає із бази даних поля, які знаходяться найближче до вказаних точок та відправляє інформацію цільові точки та поля, які знаходяться поруч у **Kafka** в канал **field-processing**. Додати відповідний *Dockerfile* для створення контейнеру та налаштувати запуск у *docker-compose*.
7. Створити сервіс, який читає дані про поля із **Kafka** каналу **field-processing**, для кожного поля у запиті читає інформацію про вологість грунту із файлу **soil_moisture.tif** та зберігає її у файл json наступної структури:	
``` json
{
"point_of_interest": {
"lat": <координата точки із файлу POI.txt>,
"lon": <координата точки із файлу POI.txt>,
},
"field_data": {
"name": <назва поля із бази даних>,
"lat": <координата поля із бази даних>,
"lon": <координата поля із бази даних>,
},
"moisture": <значення вологості для координати центру поля із файлу soil_moisture.tif>
} 
``` 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Додати відповідний *Dockerfile* для створення контейнеру та налаштувати запуск у *docker-compose*.

8. Додати у файл *.env* усі необхідні для запуску змінні оточення.
9. Запустити усі сервіси разом, щоб переконатись у їх дієздатності та комунікації.
10. Зберегти усі зміни та відправити у віддалений репозиторій.

Як відповідь на лабораторну додайте посилання на репозиторій у відповідну колонку в Таблицю лабораторних робіт.
Надалі усі лабораторні будуть виконуватись у цьому репозиторії в окремих каталогах.

# How to run

### 1. Create ***.env*** file in *Lab8*, *db* and *service1* folders
```
POSTGRES_USER=***
POSTGRES_PASSWORD=***
POSTGRES_DB=***
```

### 2. Check if there is *field_centroids.geojson* in *service1/data* folder
### 3. Update *service2/POI.txt* with your points
### 4. Run docker-compose
``` bash
docker-compose up -d
```
### 5. Fetch generated files from *service3/output* for points you provided
### 6. Stop all containers
``` bash
docker-compose down -v
```
