# 8 

### 1. Створити у репозиторії каталог із назвою Lab_08. Всю необхідну структуру проектів та мікросервісів необхідно виконувати у ньому.
### 2. Створити .env файл для збереження параметрів сервісів та підключень.
```
POSTGRES_USER=[user]
POSTGRES_PASSWORD=[password]
POSTGRES_DB=[database]
```	
3. Створити Dockerfile, який завантажує образ бази даних PostgreSQL із розширенням PostGIS.
``` dockerfile
# Шаблон

# Використовуйте базовий образ з підтримкою потрібної вам мови програмування або середовища
FROM base_image:tag

# Встановлюємо необхідні залежності для вашого проекту
RUN apt-get update && apt-get install -y dependency1 dependency2

# Копіюємо файли проекту в контейнер
COPY . /app

# Встановлюємо робочу директорію в контейнері
WORKDIR /app

# Запускаємо необхідні команди для налаштування проекту
RUN command1 && command2

# Вказуємо команду, яка буде виконуватися при запуску контейнера
CMD ["command", "arg1", "arg2"]

```	
4. Створити docker-compose.yml файл, який запускає сервіси Zookeeper, Kafka та база даних на основі попереднього пункту
5. Створити сервіс, який із датасету field_centroids.geojson читає дані про поля та записує їх у створену базу даних. Коли інформація про поля додана у базу, він відправляє у Kafka в канал field-reading відповідне повідомлення. Додати відповідний Dockerfile для створення контейнеру та налаштувати запуск у docker-compose.
6. Створити сервіс, який чекає у Kafka в канал field-reading повідомлення про наявність полів у базі даних. Після цього він читає координати із текстового файлу POI.txt, вибирає із бази даних поля, які знаходяться найближче до вказаних точок та відправляє інформацію цільові точки та поля, які знаходяться поруч у Kafka в канал field-processing. Додати відповідний Dockerfile для створення контейнеру та налаштувати запуск у docker-compose.
7. Створити сервіс, який читає дані про поля із Kafka каналу field-processing, для кожного поля у запиті читає інформацію про вологість грунту із файлу soil_moisture.tif та зберігає її у файл json наступної структури:
```	
{
    “point_of_interest”: {
    “lat”: <координата точки із файлу POI.txt>,
    “lon”: <координата точки із файлу POI.txt>,
    },
    “field_data”: {
    “name”: <назва поля із бази даних>,
    “lat”: <координата поля із бази даних>,
    “lon”: <координата поля із бази даних>,
    },
    “moisture”: <значення вологості для координати центру поля із файлу soil_moisture.tif>
} 
```	
## Результат
### 1
```	json
{
    "point_of_interest": {
        "lat": 30.34429249760622,
        "lon": 50.08611402259139
    },
    "field_data": {
        "name": "Ks1",
        "lat": 30.34448115085623,
        "lon": 50.06295931046618
    },
    "moisture": 2952
}
```
### 2
``` json
{
    "point_of_interest": {
        "lat": 30.200147418254954,
        "lon": 50.08152374376293
    },
    "field_data": {
        "name": "Pin17",
        "lat": 30.211041637442243,
        "lon": 50.06570767130525
    },
    "moisture": 2492
}
```

### 3
``` json
{
    "point_of_interest": {
        "lat": 30.250466317024095,
        "lon": 49.96575297878594
    },
    "field_data": {
        "name": "Tr7/1",
        "lat": 30.250268297428843,
        "lon": 49.98931843919832
    },
    "moisture": 2365
}
```

### 4
``` json
{
    "point_of_interest": {
        "lat": 30.546747418254956,
        "lon": 50.24552374376293
    },
    "field_data": {
        "name": "Yatz36",
        "lat": 30.44503915052578,
        "lon": 50.03303109984244
    },
    "moisture": 65535
}
```

# Результат 1.geojson
``` 
{
    "type": "FeatureCollection",
    "name": "field_data",
    "crs": {
      "type": "name",
      "properties": {
        "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
      }
    },
    "features": [
      {
        "type": "Feature",
        "properties": {
          "moisture": 2952
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            30.34429249760622,
            50.08611402259139
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "moisture": 2492
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            30.200147418254954,
            50.08152374376293
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "moisture": 2365
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            30.250466317024095,
            49.96575297878594
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "moisture": 65535
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            30.546747418254956,
            50.24552374376293
          ]
        }
      }
    ]
  }
  
```

Додати відповідний Dockerfile для створення контейнеру та налаштувати запуск у docker-compose.
8. Додати у файл .env усі необхідні для запуску змінні оточення.
9. Запустити усі сервіси разом, щоб переконатись у їх дієздатності та комунікації.
10.  Зберегти усі зміни та відправити у віддалений репозиторій.

